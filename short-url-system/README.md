# çŸ­é“¾æ¥ç³»ç»Ÿ (Short URL System)

> ğŸ”— é«˜æ€§èƒ½çŸ­é“¾æ¥æœåŠ¡ - é¢è¯•äº®ç‚¹é¡¹ç›®

## ğŸ“Œ æ ¸å¿ƒæŠ€æœ¯ç‚¹

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹æ¡ˆ | è¯´æ˜ |
|-------|---------|------|
| çŸ­ç ç”Ÿæˆ | å‘å·å™¨ + 62è¿›åˆ¶ | è‡ªå¢IDè½¬æ¢ï¼Œæ°¸ä¸é‡å¤ |
| å¸ƒéš†è¿‡æ»¤å™¨ | Redisson | å¿«é€Ÿåˆ¤æ–­çŸ­ç å­˜åœ¨æ€§ |
| é«˜å¹¶å‘è¯» | Redisç¼“å­˜ | ç¼“å­˜çƒ­ç‚¹æ•°æ® |
| é˜²ç¼“å­˜ç©¿é€ | å¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜ | åŒé‡é˜²æŠ¤ |
| æ•°æ®ç»Ÿè®¡ | å¼‚æ­¥æ—¥å¿— + èšåˆæŸ¥è¯¢ | PV/UV/è®¾å¤‡åˆ†å¸ƒ |

## ğŸ¯ é¢è¯•å¿…é—®ï¼šå¦‚ä½•ç”Ÿæˆä¸é‡å¤çš„çŸ­ç ï¼Ÿ

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|---------|
| å‘å·å™¨+62è¿›åˆ¶ | ç®€å•å¯é ï¼Œæ°¸ä¸é‡å¤ | çŸ­ç å¯é¢„æµ‹ | é€šç”¨åœºæ™¯ï¼ˆæœ¬é¡¹ç›®é‡‡ç”¨ï¼‰ |
| Hashç®—æ³• | åˆ†æ•£éšæœº | å¯èƒ½å†²çª | éœ€éšæœºæ€§åœºæ™¯ |
| éšæœºç”Ÿæˆ | å®Œå…¨éšæœº | éœ€é¢‘ç¹å»é‡ | å®‰å…¨æ€§è¦æ±‚é«˜ |
| é›ªèŠ±ç®—æ³• | åˆ†å¸ƒå¼å”¯ä¸€ | çŸ­ç è¾ƒé•¿ | åˆ†å¸ƒå¼ç³»ç»Ÿ |

### å‘å·å™¨æ–¹æ¡ˆè¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‘å·å™¨ + 62è¿›åˆ¶è½¬æ¢                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  æ•°æ®åº“ï¼ˆå·æ®µè¡¨ï¼‰                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ biz_tag: short_url                         â”‚              â”‚
â”‚  â”‚ max_id: 100000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> 101000         â”‚              â”‚
â”‚  â”‚ step: 1000                                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚                                               â”‚
â”‚              â”‚ æ¯æ¬¡å–1000ä¸ªIDåˆ°å†…å­˜                           â”‚
â”‚              â–¼                                               â”‚
â”‚  å†…å­˜ï¼ˆå½“å‰å·æ®µï¼‰                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ start: 100001                              â”‚              â”‚
â”‚  â”‚ end: 101000                                â”‚              â”‚
â”‚  â”‚ current: 100001 â†’ 100002 â†’ ... â†’ 101000    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚                                               â”‚
â”‚              â”‚ 62è¿›åˆ¶è½¬æ¢                                     â”‚
â”‚              â–¼                                               â”‚
â”‚  çŸ­ç : 100001 â†’ "q0T9" (6ä½)                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ä»£ç 

```java
// 62è¿›åˆ¶å­—ç¬¦é›†
private static final String CHARSET = 
    "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

// IDè½¬62è¿›åˆ¶
private String encode(long id) {
    StringBuilder sb = new StringBuilder();
    int base = 62;
    
    while (id > 0) {
        sb.append(CHARSET.charAt((int) (id % base)));
        id /= base;
    }
    
    return sb.reverse().toString();
}

// 62^6 = 56,800,235,584 (è¶…è¿‡560äº¿ä¸ªçŸ­ç )
```

## ğŸŒ¸ å¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£

### åŸç†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¸ƒéš†è¿‡æ»¤å™¨åŸç†                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  æ·»åŠ å…ƒç´  "abc123"ï¼š                                         â”‚
â”‚                                                              â”‚
â”‚  Hash1("abc123") = 3                                        â”‚
â”‚  Hash2("abc123") = 7                                        â”‚
â”‚  Hash3("abc123") = 11                                       â”‚
â”‚                                                              â”‚
â”‚  Bit Array:                                                  â”‚
â”‚  â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”                         â”‚
â”‚  â”‚0â”‚0â”‚0â”‚1â”‚0â”‚0â”‚0â”‚1â”‚0â”‚0â”‚0â”‚1â”‚0â”‚0â”‚0â”‚0â”‚                         â”‚
â”‚  â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜                         â”‚
â”‚        â†‘       â†‘       â†‘                                    â”‚
â”‚        3       7       11                                    â”‚
â”‚                                                              â”‚
â”‚  æŸ¥è¯¢ "abc123"ï¼šæ£€æŸ¥ä½ç½®3ã€7ã€11æ˜¯å¦éƒ½ä¸º1                     â”‚
â”‚  - éƒ½ä¸º1 â†’ å¯èƒ½å­˜åœ¨                                          â”‚
â”‚  - æœ‰0   â†’ ä¸€å®šä¸å­˜åœ¨                                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åº”ç”¨åœºæ™¯

```java
// 1. åˆ›å»ºçŸ­ç æ—¶æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨
bloomFilter.add(shortCode);

// 2. æŸ¥è¯¢æ—¶å…ˆç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­
if (!bloomFilter.mightContain(shortCode)) {
    // ä¸€å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
    return null;
}

// 3. å¯èƒ½å­˜åœ¨ï¼ŒæŸ¥è¯¢ç¼“å­˜/æ•°æ®åº“
String longUrl = redisTemplate.opsForValue().get(cacheKey);
```

## ğŸ”„ çŸ­é“¾æ¥è®¿é—®æµç¨‹

```
ç”¨æˆ·è¯·æ±‚: http://s.octo.com/abc123
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­     â”‚ â† å¿«é€Ÿåˆ¤æ–­çŸ­ç æ˜¯å¦å¯èƒ½å­˜åœ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€ ä¸å­˜åœ¨ â”€â”€> è¿”å›404
          â”‚
          â–¼ å¯èƒ½å­˜åœ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢Redisç¼“å­˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€ å‘½ä¸­ â”€â”€> 302é‡å®šå‘
          â”‚
          â–¼ æœªå‘½ä¸­
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢æ•°æ®åº“         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€ ä¸å­˜åœ¨ â”€â”€> ç¼“å­˜ç©ºå€¼(é˜²ç©¿é€) â”€â”€> è¿”å›404
          â”‚
          â–¼ å­˜åœ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›å†™Redisç¼“å­˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼‚æ­¥è®°å½•è®¿é—®æ—¥å¿—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  302é‡å®šå‘åˆ°åŸURL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡

```sql
-- PV (Page View)
SELECT COUNT(1) FROM t_access_log WHERE short_code = 'abc123';

-- UV (Unique Visitor)
SELECT COUNT(DISTINCT ip) FROM t_access_log WHERE short_code = 'abc123';

-- è®¾å¤‡ç±»å‹åˆ†å¸ƒ
SELECT device_type, COUNT(1) as count 
FROM t_access_log WHERE short_code = 'abc123' 
GROUP BY device_type;

-- è®¿é—®è¶‹åŠ¿ï¼ˆæŒ‰å¤©ï¼‰
SELECT DATE(access_time) as date, COUNT(1) as pv
FROM t_access_log WHERE short_code = 'abc123'
GROUP BY DATE(access_time);
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
short-url-system/
â”œâ”€â”€ src/main/java/com/octo/shorturl/
â”‚   â”œâ”€â”€ ShortUrlApplication.java     # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â””â”€â”€ Result.java              # ç»Ÿä¸€å“åº”
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ ShortUrlController.java  # çŸ­é“¾æ¥æ¥å£
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â””â”€â”€ CreateShortUrlRequest.java
â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ ShortUrl.java            # çŸ­é“¾æ¥
â”‚   â”‚   â”œâ”€â”€ AccessLog.java           # è®¿é—®æ—¥å¿—
â”‚   â”‚   â””â”€â”€ IdSegment.java           # å·æ®µè¡¨
â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”œâ”€â”€ ShortUrlMapper.java
â”‚   â”‚   â”œâ”€â”€ AccessLogMapper.java
â”‚   â”‚   â””â”€â”€ IdSegmentMapper.java
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ ShortUrlService.java     # çŸ­é“¾æ¥æœåŠ¡
â”‚       â”œâ”€â”€ ShortCodeGenerator.java  # çŸ­ç ç”Ÿæˆå™¨
â”‚       â”œâ”€â”€ BloomFilterService.java  # å¸ƒéš†è¿‡æ»¤å™¨
â”‚       â””â”€â”€ AccessStatService.java   # è®¿é—®ç»Ÿè®¡
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.yml
    â””â”€â”€ db/schema.sql
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒè¦æ±‚

- JDK 17+
- MySQL 8.0+
- Redis 6.0+

### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
mysql -u root -p < src/main/resources/db/schema.sql
```

### 3. å¯åŠ¨åº”ç”¨

```bash
mvn spring-boot:run
```

## ğŸ“¡ APIæ¥å£

### åˆ›å»ºçŸ­é“¾æ¥

```bash
POST /api/short-url/create
Content-Type: application/json

{
  "longUrl": "https://www.example.com/very/long/url/path",
  "creatorId": 10001,
  "expireTime": "2026-12-31T23:59:59"
}

# å“åº”
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": "http://s.octo.com/abc123"
}
```

### è®¿é—®çŸ­é“¾æ¥

```bash
GET /abc123

# 302 Redirect to https://www.example.com/very/long/url/path
```

### è·å–ç»Ÿè®¡æ•°æ®

```bash
GET /api/short-url/stats?shortCode=abc123

# å“åº”
{
  "code": 200,
  "data": {
    "pv": 12580,
    "uv": 8964,
    "dailyPv": [...],
    "deviceTypes": [...],
    "browsers": [...]
  }
}
```

## ğŸ” é¢è¯•å¸¸è§è¿½é—®

### 1. ä¸ºä»€ä¹ˆç”¨62è¿›åˆ¶è€Œä¸æ˜¯å…¶ä»–è¿›åˆ¶ï¼Ÿ

- 62 = 10(æ•°å­—) + 26(å¤§å†™å­—æ¯) + 26(å°å†™å­—æ¯)
- URLå‹å¥½ï¼Œä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦
- 6ä½çŸ­ç å¯è¡¨ç¤º 62^6 â‰ˆ 568äº¿ä¸ªé“¾æ¥

### 2. å¸ƒéš†è¿‡æ»¤å™¨è¯¯åˆ¤ç‡å¦‚ä½•æ§åˆ¶ï¼Ÿ

```java
// è¯¯åˆ¤ç‡è®¡ç®—: (1 - e^(-kn/m))^k
// m: bitæ•°ç»„å¤§å°
// n: å…ƒç´ æ•°é‡  
// k: hashå‡½æ•°ä¸ªæ•°

// é…ç½®ç¤ºä¾‹ï¼š1äº¿æ•°æ®ï¼Œ0.1%è¯¯åˆ¤ç‡ï¼Œéœ€è¦çº¦143MBå†…å­˜
bloomFilter.tryInit(100_000_000, 0.001);
```

### 3. å¦‚ä½•é˜²æ­¢ç¼“å­˜ç©¿é€ï¼Ÿ

1. **å¸ƒéš†è¿‡æ»¤å™¨**ï¼šå¿«é€Ÿåˆ¤æ–­ä¸å­˜åœ¨çš„Key
2. **ç©ºå€¼ç¼“å­˜**ï¼šä¸å­˜åœ¨çš„Keyç¼“å­˜ç©ºå€¼ï¼Œè®¾ç½®çŸ­è¿‡æœŸæ—¶é—´

### 4. é«˜å¹¶å‘ä¸‹å¦‚ä½•ä¿è¯æ€§èƒ½ï¼Ÿ

1. **ç¼“å­˜çƒ­ç‚¹æ•°æ®**ï¼šRedisç¼“å­˜çŸ­é“¾æ¥æ˜ å°„
2. **å·æ®µæ¨¡å¼**ï¼šå‡å°‘æ•°æ®åº“è®¿é—®
3. **å¼‚æ­¥è®°å½•æ—¥å¿—**ï¼šä¸é˜»å¡ä¸»æµç¨‹
4. **è¯»å†™åˆ†ç¦»**ï¼šä¸»åº“å†™ï¼Œä»åº“è¯»

### 5. çŸ­ç å†²çªå¦‚ä½•å¤„ç†ï¼Ÿ

å‘å·å™¨æ–¹æ¡ˆä¸ä¼šå†²çªï¼ˆè‡ªå¢IDä¿è¯å”¯ä¸€ï¼‰ã€‚

å¦‚æœç”¨Hashæ–¹æ¡ˆï¼š
```java
String shortCode = hash(longUrl);
while (exists(shortCode)) {
    shortCode = hash(longUrl + salt++);
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¤šçº§ç¼“å­˜**ï¼šæœ¬åœ°ç¼“å­˜ + Redis
2. **åˆ†åº“åˆ†è¡¨**ï¼šæŒ‰çŸ­ç Hashåˆ†è¡¨
3. **è¯»å†™åˆ†ç¦»**ï¼šåˆ†ç¦»è¯»å†™å‹åŠ›
4. **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºCDNåˆ†å‘

## ğŸ“ License

MIT License

